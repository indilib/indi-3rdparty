cmake_minimum_required (VERSION 3.0)
project (liburjtag)

set(LIB_INSTALL_DIR "${CMAKE_INSTALL_PREFIX}/${CMAKE_INSTALL_LIBDIR}")
set(URJTAG_VERSION_MAJOR 0)
set(URJTAG_VERSION_MINOR 0)
set(URJTAG_VERSION_RELEASE 0)
set(AHPXC_VERSION "${URJTAG_VERSION_MAJOR}.${URJTAG_VERSION_MINOR}.${URJTAG_VERSION_RELEASE}")
set(AHPXC_SOVERSION ${URJTAG_VERSION_MAJOR})

list (APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/cmake_modules/")
list (APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/../cmake_modules/")
list (APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_SOURCE_DIR}/../../cmake_modules/")
include (GNUInstallDirs)
include (InstallImported)

find_package(FTDI REQUIRED)
find_package(USB REQUIRED)

add_library (urjtag SHARED IMPORTED)

set_target_properties (urjtag PROPERTIES VERSION ${AHPXC_VERSION} SOVERSION ${AHPXC_SOVERSION})

if (UNIX AND NOT WIN32 AND NOT APPLE)

  if (CMAKE_SYSTEM_PROCESSOR MATCHES "armv+")
    set_property (TARGET urjtag PROPERTY IMPORTED_LOCATION "liburjtag.so.armhf")
  elseif (CMAKE_SYSTEM_PROCESSOR MATCHES "aarch64")
    set_property (TARGET urjtag PROPERTY IMPORTED_LOCATION "liburjtag.so.arm64")
  elseif (CMAKE_SIZEOF_VOID_P MATCHES "8")
    set_property (TARGET urjtag PROPERTY IMPORTED_LOCATION "liburjtag.so.amd64")
  else (CMAKE_SIZEOF_VOID_P MATCHES "8")
    set_property (TARGET urjtag PROPERTY IMPORTED_LOCATION "liburjtag.so.i386")
  endif ()

endif ()

# Install header files
install (FILES bfin.h DESTINATION include/urjtag)
install (FILES bitmask.h DESTINATION include/urjtag)
install (FILES bitops.h DESTINATION include/urjtag)
install (FILES bsbit.h DESTINATION include/urjtag)
install (FILES bsdl.h DESTINATION include/urjtag)
install (FILES bsdl_mode.h DESTINATION include/urjtag)
install (FILES bssignal.h DESTINATION include/urjtag)
install (FILES bus_driver.h DESTINATION include/urjtag)
install (FILES bus.h DESTINATION include/urjtag)
install (FILES cable.h DESTINATION include/urjtag)
install (FILES chain.h DESTINATION include/urjtag)
install (FILES cmd.h DESTINATION include/urjtag)
install (FILES data_register.h DESTINATION include/urjtag)
install (FILES error.h DESTINATION include/urjtag)
install (FILES fclock.h DESTINATION include/urjtag)
install (FILES flash.h DESTINATION include/urjtag)
install (FILES gettext.h DESTINATION include/urjtag)
install (FILES jim.h DESTINATION include/urjtag)
install (FILES jtag.h DESTINATION include/urjtag)
install (FILES log.h DESTINATION include/urjtag)
install (FILES params.h DESTINATION include/urjtag)
install (FILES parport.h DESTINATION include/urjtag)
install (FILES parse.h DESTINATION include/urjtag)
install (FILES part.h DESTINATION include/urjtag)
install (FILES part_instruction.h DESTINATION include/urjtag)
install (FILES pld.h DESTINATION include/urjtag)
install (FILES pod.h DESTINATION include/urjtag)
install (FILES stapl.h DESTINATION include/urjtag)
install (FILES svf.h DESTINATION include/urjtag)
install (FILES tap.h DESTINATION include/urjtag)
install (FILES tap_register.h DESTINATION include/urjtag)
install (FILES tap_state.h DESTINATION include/urjtag)
install (FILES types.h DESTINATION include/urjtag)
install (FILES urjtag.h DESTINATION include/urjtag)
install (FILES usbconn.h DESTINATION include/urjtag)

# Install library
install_imported (TARGETS urjtag DESTINATION ${CMAKE_INSTALL_LIBDIR})
