CMAKE_MINIMUM_REQUIRED (VERSION 3.0)

FIND_PACKAGE (GMock REQUIRED)
FIND_PACKAGE (Threads REQUIRED)

MESSAGE (STATUS "GTEST_BOTH_LIBRARIES ${GTEST_BOTH_LIBRARIES}")
MESSAGE (STATUS "GTEST_MAIN_LIBRARIES ${GTEST_MAIN_LIBRARIES}")
MESSAGE (STATUS "GTEST_LIBRARIES ${GTEST_LIBRARIES}")
MESSAGE (STATUS "GTEST_INCLUDE_DIRS ${GTEST_INCLUDE_DIRS}")
MESSAGE (STATUS "GMOCK_LIBRARIES ${GMOCK_LIBRARIES}")
MESSAGE (STATUS "GMOCK_INCLUDE_DIRS ${GMOCK_INCLUDE_DIRS}")

ENABLE_TESTING()

INCLUDE_DIRECTORIES ( ${GTEST_INCLUDE_DIRS} )
INCLUDE_DIRECTORIES ( ${GMOCK_INCLUDE_DIRS} )
INCLUDE_DIRECTORIES ( ${CMAKE_SOURCE_DIR} )

SET (test_mmaldriver_SRCS
	test_mmaldriver.cpp ${INDI_RPICAM_SRCS}
)

if (NOT MSVC)
    set (PTHREAD_LIBRARIES -pthread)
endif()

ADD_EXECUTABLE(test_mmaldriver
	${test_mmaldriver_SRCS}
)

if (NOT MSVC)
    set (PTHREAD_LIBRARIES -pthread)
endif()

target_link_libraries(test_mmaldriver 
        ${INDI_DRIVER_LIBRARIES}
        ${CFITSIO_LIBRARIES}
        ${GTEST_BOTH_LIBRARIES}
        ${GMOCK_LIBRARIES}
        ${INDI_LIBRARIES}
        ${MMAL_LIBRARIES}
        ${Threads_LIBRARIES}
        ${PTHREAD_LIBRARIES} 
        ${CMAKE_DL_LIBS})

ADD_TEST(test_mmaldriver test_mmaldriver)
